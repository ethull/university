-- task1
--CentreID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
CREATE TABLE Centre (
    CentreID INTEGER PRIMARY KEY,
    Name VARCHAR(255) NOT NULL,
    Address VARCHAR(255) NOT NULL,
    PhoneNo VARCHAR(255) NOT NULL
);
CREATE TABLE Car (
    CarID INTEGER PRIMARY KEY,
    RegNo VARCHAR(255) UNIQUE NOT NULL,
    Model VARCHAR(255) NOT NULL
);
CREATE TABLE School (
    SchoolID INTEGER PRIMARY KEY,
    Address VARCHAR(255) NOT NULL
);
CREATE TABLE AdminStaff (
    EmpID INTEGER PRIMARY KEY,
    Forename VARCHAR(255) NOT NULL,
    Surname VARCHAR(255) NOT NULL,
    Gender CHAR(1) CHECK (Gender IN ('M', 'F', 'O')) NOT NULL,
    PhoneNo VARCHAR(255) NOT NULL,
    Address VARCHAR(255) NOT NULL,
    Role VARCHAR(255) NOT NULL,
    SchoolID INTEGER NOT NULL,
    FOREIGN KEY (SchoolID) REFERENCES School(SchoolID)
);
CREATE TABLE Instructor (
    EmpID INTEGER PRIMARY KEY,
    Forename VARCHAR(255) NOT NULL,
    Surname VARCHAR(255) NOT NULL,
    Gender CHAR(1) CHECK (Gender IN ('M', 'F', 'O')) NOT NULL,
    PhoneNo VARCHAR(255) NOT NULL,
    Address VARCHAR(255) NOT NULL,
    LicenceNo VARCHAR(255) UNIQUE NOT NULL,
    SchoolID INTEGER NOT NULL,
    CarID INTEGER NOT NULL,
    FOREIGN KEY (SchoolID) REFERENCES School(SchoolID),
    FOREIGN KEY (CarID) REFERENCES Car(CarID)
);
CREATE TABLE Client (
    ClientID INTEGER PRIMARY KEY,
    Forename VARCHAR(255) NOT NULL,
    Surname VARCHAR(255) NOT NULL,
    Gender CHAR(1) CHECK (Gender IN ('M', 'F', 'O')) NOT NULL,
    DoB DATE NOT NULL,
    PhoneNo VARCHAR(255) NOT NULL,
    Address VARCHAR(255) NOT NULL,
    ProvLicenceNo VARCHAR(255) UNIQUE NOT NULL,
    SchoolID INTEGER NOT NULL,
    FOREIGN KEY (SchoolID) REFERENCES School(SchoolID)
);
CREATE TABLE Lesson (
    OnDate DATE NOT NULL,
    OnTime TIME NOT NULL,
    ClientID INTEGER NOT NULL,
    EmpID INTEGER NOT NULL,
    UNIQUE(OnDate, OnTime, EmpID),
    PRIMARY KEY (OnDate, OnTime, ClientID),
    FOREIGN KEY (ClientID) REFERENCES Client(ClientID),
    FOREIGN KEY (EmpID) REFERENCES Instructor(EmpID)
);
CREATE TABLE Test (
    OnDate DATE NOT NULL,
    OnTime TIME NOT NULL,
    ClientID INTEGER NOT NULL,
    EmpID INTEGER NOT NULL,
    CentreID INTEGER NOT NULL,
    Status VARCHAR(9) CHECK (Status IN ('Not Taken', 'Passed', 'Failed')) NOT NULL,
    Reason VARCHAR(255),
    UNIQUE(OnDate, OnTime, EmpID),
    PRIMARY KEY (OnDate, OnTime, ClientID),
    FOREIGN KEY (ClientID) REFERENCES Client(ClientID),
    FOREIGN KEY (EmpID) REFERENCES Instructor(EmpID),
    FOREIGN KEY (CentreID) REFERENCES Centre(CentreID)
);

-- insert statements
INSERT INTO Centre (CentreID, Name, Address, PhoneNo) VALUES (1, 'Canterbury', '12 Meryl Street', '+44 1227-968-5287');
INSERT INTO Centre (CentreID, Name, Address, PhoneNo) VALUES (2, 'Whitstable', '5 The Strand, Whitstable', '01227457012');
INSERT INTO Centre (CentreID, Name, Address, PhoneNo) VALUES (3, 'Faversham', '1 High Street', '01795 865129');

INSERT INTO Car VALUES (124, 'BD51 SMR', 'VW Polo');
INSERT INTO Car VALUES (653, 'WS62 QWE', 'Ford Focus');
INSERT INTO Car VALUES (912, 'FD52 TGF', 'VW Polo');
INSERT INTO Car VALUES (167, 'FD52 YTR', 'VW Polo');

INSERT INTO School (SchoolID, Address) VALUES (1, '12 Whitechapel, Canterbury');
INSERT INTO School (SchoolID, Address) VALUES (2, '9 Middle Wall, Whitstable');

INSERT INTO AdminStaff VALUES (1006, 'Fred', 'Grimes', 'M', '012275435665', '27 Cherry Street', 'assistant', 2);
INSERT INTO AdminStaff VALUES (1009, 'Jill', 'Joffries', 'F', '+44776618645', '27 Cherry Street', 'manager', 1);
INSERT INTO AdminStaff VALUES (1019, 'Justine', 'Joffries', 'F', '(01227) 812035', '19 Creosote', 'assistant', 1);

INSERT INTO Instructor VALUES (2009, 'James', 'Joffries', 'M', '012275435665', '27 Cherry Street', 'FTR76398', 1, 124);
INSERT INTO Instructor VALUES (2011, 'Jim', 'Adams', 'M', '065490125674', '4 The Vale', 'TGY98555a', 2, 912);
INSERT INTO Instructor VALUES (2013, 'Trinny', 'Vair', 'F', '0044587208725', '17 High Street, Chartham', 'YHF7665467', 1, 653);
--INSERT INTO Instructor VALUES (4269, 'pepe', 'green', 'F', '0042069000000', 'meme land', 'YHF7642069', 1, 167);


INSERT INTO Client (ClientID, Forename, Surname, Gender, DoB, PhoneNo, Address, ProvlicenceNo, SchoolID) VALUES (1, 'Andy', 'Twill', 'M', '1998-02-01', '00446784129876', '27 Cherry Street, CT4 7NF', 'TYH7890', 2);
INSERT INTO Client (ClientID, Forename, Surname, Gender, DoB, PhoneNo, Address, ProvlicenceNo, SchoolID) VALUES (2, 'Sue', 'Adams', 'F', '1989-06-14', '0841-234-876', '45 Eggy Lane', 'CIO67891', 1);
INSERT INTO Client (ClientID, Forename, Surname, Gender, DoB, PhoneNo, Address, ProvlicenceNo, SchoolID) VALUES (3, 'Jean', 'Adams', 'F', '2001-11-19', '01227765329', '4 Harkness Lane, Canterbury', 'RTY678923', 1);

INSERT INTO Lesson VALUES ('2020-06-24', '10:00:00', 1, 2011);
INSERT INTO Lesson VALUES ('2019-06-07', '10:00:00', 2, 2009);
INSERT INTO Lesson VALUES ('2020-07-12', '14:00:00', 1, 2011);
INSERT INTO Lesson VALUES ('2020-08-19', '16:00:00', 1, 2011);
INSERT INTO Lesson VALUES ('2020-08-17', '16:00:00', 2, 2009);
INSERT INTO Lesson VALUES ('2020-08-01', '14:00:00', 1, 2011);

INSERT INTO Test VALUES ('2021-03-01', '11:00:00', 1, 2011, 2, 'Passed', NULL);
INSERT INTO Test VALUES ('2019-08-13', '13:00:00', 2, 2009, 3, 'Failed', 'Lack of Observation');
INSERT INTO Test VALUES ('2019-10-21', '11:00:00', 2, 2009, 2, 'Failed', 'Speeding');
INSERT INTO Test VALUES ('2020-08-19', '10:00:00', 2, 2013, 2, 'Not Taken', NULL);


-- task2
--2a
SELECT Status, COUNT(Status)
FROM Test t
WHERE t.ClientID IN (SELECT ClientID FROM Client WHERE Gender = 'F')
GROUP BY Status 
HAVING COUNT(Status) >=0
;
--WHERE (SELECT ClientID FROM Client WHERE Gender = 'F') = t.ClientID --doesnt work as >1 row returned
--2b
SELECT EmpID, Forename, Surname FROM AdminStaff WHERE Surname = 'Joffries'
UNION
SELECT EmpID, Forename, Surname FROM Instructor WHERE Surname = 'Joffries'
;
--2c
SELECT s.Address AS SchoolAddress, s.SchoolID, Forename, Surname
FROM Instructor i JOIN School s ON i.SchoolID = s.SchoolID
WHERE EmpID NOT IN (SELECT EmpID from Test)
;
--2d
SELECT ct.name AS CentreName, t.onDate, t.onTime, t.Status, cl.Forename AS ClientForename, cl.Surname AS ClientSurname, s.Address As SchoolAddress, ca.Model As CarModel
FROM Centre ct
    JOIN Test t ON ct.CentreID = t.CentreID
    JOIN Client cl ON cl.ClientID = t.ClientID
    JOIN Instructor i ON i.EmpID = t.EmpID
    JOIN School s ON s.SchoolID = i.SchoolID
    JOIN Car ca ON ca.CarID = i.CarID
WHERE ct.name = 'Whitstable'
;


DROP TABLE Centre, Car, School, AdminStaff, Instructor, Client, Lesson, Test;
